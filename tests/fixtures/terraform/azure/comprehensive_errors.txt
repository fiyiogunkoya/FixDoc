# Azure Terraform Errors - Comprehensive Test Fixtures
# Real-world Azure resource creation and configuration errors

# ============================================================================
# Test Case 1: Storage Account Name Already Exists (Globally)
# ============================================================================

Terraform will perform the following actions:

  # azurerm_storage_account.main will be created

Plan: 1 to add, 0 to change, 0 to destroy.

azurerm_storage_account.main: Creating...

│ Error: creating Storage Account (Subscription: "12345678-1234-1234-1234-123456789abc"
│ Resource Group Name: "rg-data-prod"
│ Storage Account Name: "stcompanydata"):
│
│ storage.AccountsClient#Create: Failure sending request: StatusCode=409
│ Code: "StorageAccountAlreadyTaken"
│ Message: "The storage account named stcompanydata is already taken."
│
│   with azurerm_storage_account.main,
│   on storage/main.tf line 1, in resource "azurerm_storage_account" "main":
│    1: resource "azurerm_storage_account" "main" {

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 2: VM Size Not Available in Region
# ============================================================================

Terraform will perform the following actions:

  # azurerm_linux_virtual_machine.ml will be created

Plan: 1 to add, 0 to change, 0 to destroy.

azurerm_linux_virtual_machine.ml: Creating...

│ Error: creating Linux Virtual Machine (Subscription: "12345678-1234-1234-1234-123456789abc"
│ Resource Group Name: "rg-ml-prod"
│ Virtual Machine Name: "vm-ml-training"):
│
│ compute.VirtualMachinesClient#CreateOrUpdate: Failure sending request: StatusCode=409
│ Code: "SkuNotAvailable"
│ Message: "The requested VM size Standard_NC24ads_A100_v4 is not available in the
│ current region. The sizes available in the current region are: Standard_D2_v3,
│ Standard_D4_v3, Standard_E2_v3..."
│
│   with azurerm_linux_virtual_machine.ml,
│   on compute/ml.tf line 15, in resource "azurerm_linux_virtual_machine" "ml":
│   15: resource "azurerm_linux_virtual_machine" "ml" {

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 3: AKS Cluster - Quota Exceeded
# ============================================================================

Terraform will perform the following actions:

  # azurerm_kubernetes_cluster.main will be created

Plan: 1 to add, 0 to change, 0 to destroy.

azurerm_kubernetes_cluster.main: Creating...
azurerm_kubernetes_cluster.main: Still creating... [2m0s elapsed]
azurerm_kubernetes_cluster.main: Still creating... [5m0s elapsed]

│ Error: creating Kubernetes Cluster (Subscription: "12345678-1234-1234-1234-123456789abc"
│ Resource Group Name: "rg-k8s-prod"
│ Kubernetes Cluster Name: "aks-prod-cluster"):
│
│ containerservice.ManagedClustersClient#CreateOrUpdate: Failure sending request: StatusCode=400
│ Code: "QuotaExceeded"
│ Message: "Operation could not be completed as it results in exceeding approved
│ standardDSv3Family Cores quota. Additional details - Deployment Model: Resource Manager,
│ Location: eastus, Current Limit: 100, Current Usage: 96, Additional Required: 16,
│ (Alarm) New Limit Required: 112."
│
│   with azurerm_kubernetes_cluster.main,
│   on kubernetes/main.tf line 1, in resource "azurerm_kubernetes_cluster" "main":
│    1: resource "azurerm_kubernetes_cluster" "main" {

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 4: Key Vault - Soft Delete Conflict
# ============================================================================

Terraform will perform the following actions:

  # azurerm_key_vault.main will be created

Plan: 1 to add, 0 to change, 0 to destroy.

azurerm_key_vault.main: Creating...

│ Error: creating Key Vault (Subscription: "12345678-1234-1234-1234-123456789abc"
│ Resource Group Name: "rg-security-prod"
│ Key Vault Name: "kv-prod-secrets"):
│
│ keyvault.VaultsClient#CreateOrUpdate: Failure sending request: StatusCode=409
│ Code: "ConflictError"
│ Message: "A vault with the same name already exists in deleted state.
│ You need to either recover or purge existing key vault.
│ Deleted vault: https://kv-prod-secrets.vault.azure.net"
│
│   with azurerm_key_vault.main,
│   on security/keyvault.tf line 1, in resource "azurerm_key_vault" "main":
│    1: resource "azurerm_key_vault" "main" {

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 5: SQL Database - Firewall Rule Limit
# ============================================================================

Terraform will perform the following actions:

  # azurerm_mssql_firewall_rule.new_ip will be created

Plan: 1 to add, 0 to change, 0 to destroy.

azurerm_mssql_firewall_rule.new_ip: Creating...

│ Error: creating Firewall Rule (Subscription: "12345678-1234-1234-1234-123456789abc"
│ Resource Group Name: "rg-data-prod"
│ Server Name: "sql-data-prod"
│ Firewall Rule Name: "allow-office-128"):
│
│ sql.FirewallRulesClient#CreateOrUpdate: Failure sending request: StatusCode=400
│ Code: "FirewallRulesLimitExceeded"
│ Message: "The server has reached its limit of 128 firewall rules.
│ Delete existing rules before adding new ones."
│
│   with azurerm_mssql_firewall_rule.new_ip,
│   on database/firewall.tf line 256, in resource "azurerm_mssql_firewall_rule" "new_ip":
│  256: resource "azurerm_mssql_firewall_rule" "new_ip" {

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 6: App Service Plan - Linux/Windows Mismatch
# ============================================================================

Terraform will perform the following actions:

  # azurerm_linux_web_app.api will be created

Plan: 1 to add, 0 to change, 0 to destroy.

azurerm_linux_web_app.api: Creating...

│ Error: creating Linux Web App (Subscription: "12345678-1234-1234-1234-123456789abc"
│ Resource Group Name: "rg-app-prod"
│ Web App Name: "app-api-prod"):
│
│ web.AppsClient#CreateOrUpdate: Failure sending request: StatusCode=400
│ Code: "InvalidLinuxFxVersion"
│ Message: "Linux apps cannot be deployed to a Windows App Service Plan.
│ Service Plan 'asp-windows-prod' is configured for Windows."
│
│   with azurerm_linux_web_app.api,
│   on app/main.tf line 22, in resource "azurerm_linux_web_app" "api":
│   22: resource "azurerm_linux_web_app" "api" {

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 7: Virtual Network Peering - Address Space Overlap
# ============================================================================

Terraform will perform the following actions:

  # azurerm_virtual_network_peering.hub_to_spoke will be created

Plan: 1 to add, 0 to change, 0 to destroy.

azurerm_virtual_network_peering.hub_to_spoke: Creating...

│ Error: creating Virtual Network Peering (Subscription: "12345678-1234-1234-1234-123456789abc"
│ Resource Group Name: "rg-network-hub"
│ Virtual Network Name: "vnet-hub"
│ Peering Name: "hub-to-spoke1"):
│
│ network.VirtualNetworkPeeringsClient#CreateOrUpdate: Failure sending request: StatusCode=400
│ Code: "AddressSpaceOverlaps"
│ Message: "Address space 10.0.0.0/16 in virtual network vnet-hub
│ overlaps with address space 10.0.0.0/24 in remote virtual network vnet-spoke1."
│
│   with azurerm_virtual_network_peering.hub_to_spoke,
│   on network/peering.tf line 1, in resource "azurerm_virtual_network_peering" "hub_to_spoke":
│    1: resource "azurerm_virtual_network_peering" "hub_to_spoke" {

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 8: Container Registry - Name Already Exists
# ============================================================================

Terraform will perform the following actions:

  # azurerm_container_registry.main will be created

Plan: 1 to add, 0 to change, 0 to destroy.

azurerm_container_registry.main: Creating...

│ Error: creating Container Registry (Subscription: "12345678-1234-1234-1234-123456789abc"
│ Resource Group Name: "rg-containers-prod"
│ Registry Name: "acrprodcontainers"):
│
│ containerregistry.RegistriesClient#Create: Failure sending request: StatusCode=409
│ Code: "RegistryNameAlreadyExists"
│ Message: "The registry acrprodcontainers is already in use."
│
│   with azurerm_container_registry.main,
│   on containers/acr.tf line 1, in resource "azurerm_container_registry" "main":
│    1: resource "azurerm_container_registry" "main" {

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 9: Role Assignment - Principal Not Found
# ============================================================================

Terraform will perform the following actions:

  # azurerm_role_assignment.app_to_storage will be created

Plan: 1 to add, 0 to change, 0 to destroy.

azurerm_role_assignment.app_to_storage: Creating...

│ Error: creating Role Assignment (Subscription: "12345678-1234-1234-1234-123456789abc"
│ Scope: "/subscriptions/12345678-1234-1234-1234-123456789abc/resourceGroups/rg-data-prod/providers/Microsoft.Storage/storageAccounts/stproddata"
│ Role Assignment Name: "a1b2c3d4-5678-90ab-cdef-123456789abc"):
│
│ authorization.RoleAssignmentsClient#Create: Failure sending request: StatusCode=400
│ Code: "PrincipalNotFound"
│ Message: "Principal f1e2d3c4-b5a6-9780-1234-567890abcdef does not exist
│ in the directory 11111111-2222-3333-4444-555555555555."
│
│   with azurerm_role_assignment.app_to_storage,
│   on iam/assignments.tf line 12, in resource "azurerm_role_assignment" "app_to_storage":
│   12: resource "azurerm_role_assignment" "app_to_storage" {

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 10: CosmosDB - Throughput Conflict
# ============================================================================

Terraform will perform the following actions:

  # azurerm_cosmosdb_sql_database.main will be updated in-place

Plan: 0 to add, 1 to change, 0 to destroy.

azurerm_cosmosdb_sql_database.main: Modifying...

│ Error: updating Cosmos DB SQL Database (Subscription: "12345678-1234-1234-1234-123456789abc"
│ Resource Group Name: "rg-data-prod"
│ Account Name: "cosmos-prod-data"
│ Database Name: "maindb"):
│
│ documentdb.SQLResourcesClient#UpdateSQLDatabaseThroughput: Failure sending request: StatusCode=400
│ Code: "BadRequest"
│ Message: "Cannot update throughput at database level when containers have dedicated throughput.
│ Database 'maindb' has containers with dedicated throughput configured."
│
│   with azurerm_cosmosdb_sql_database.main,
│   on database/cosmosdb.tf line 15, in resource "azurerm_cosmosdb_sql_database" "main":
│   15: resource "azurerm_cosmosdb_sql_database" "main" {
