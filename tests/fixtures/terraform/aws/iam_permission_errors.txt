# AWS IAM Permission Errors - Comprehensive Test Fixtures
# These represent real-world IAM permission issues in AWS Terraform deployments

# ============================================================================
# Test Case 1: AssumeRole Permission Denied
# ============================================================================

Terraform will perform the following actions:

  # aws_iam_role.lambda_exec will be created
  # aws_lambda_function.processor will be created

Plan: 2 to add, 0 to change, 0 to destroy.

aws_iam_role.lambda_exec: Creating...
aws_iam_role.lambda_exec: Creation complete after 2s [id=lambda-processor-role]
aws_lambda_function.processor: Creating...

│ Error: creating Lambda Function (data-processor): AccessDeniedException:
│ User: arn:aws:iam::123456789012:user/terraform-ci is not authorized to perform:
│ iam:PassRole on resource: arn:aws:iam::123456789012:role/lambda-processor-role
│ because no identity-based policy allows the iam:PassRole action
│
│   with aws_lambda_function.processor,
│   on modules/lambda/main.tf line 45, in resource "aws_lambda_function" "processor":
│   45: resource "aws_lambda_function" "processor" {

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 2: STS AssumeRole Cross-Account Failure
# ============================================================================

Terraform will perform the following actions:

  # module.cross_account.aws_s3_bucket.shared will be created

Plan: 1 to add, 0 to change, 0 to destroy.

module.cross_account.aws_s3_bucket.shared: Creating...

│ Error: configuring Terraform AWS Provider: error assuming role with arn:
│ arn:aws:iam::987654321098:role/terraform-cross-account-role
│
│ AccessDenied: User: arn:aws:iam::123456789012:user/terraform-ci
│ is not authorized to perform: sts:AssumeRole on resource:
│ arn:aws:iam::987654321098:role/terraform-cross-account-role
│
│ Status Code: 403
│ Request ID: a1b2c3d4-5678-90ab-cdef-EXAMPLE11111

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 3: KMS Key Access Denied
# ============================================================================

aws_s3_bucket.encrypted: Creating...
aws_s3_bucket.encrypted: Creation complete after 3s [id=my-encrypted-bucket-prod]
aws_s3_bucket_server_side_encryption_configuration.encrypted: Creating...

│ Error: creating S3 Bucket Server-side Encryption Configuration (my-encrypted-bucket-prod):
│ operation error S3: PutBucketEncryption, https response error StatusCode: 403,
│ RequestID: ABCD1234EFGH5678, HostID: xyz123,
│ api error AccessDenied: Access Denied to KMS key arn:aws:kms:us-east-1:123456789012:key/mrk-1234567890abcdef
│
│   with aws_s3_bucket_server_side_encryption_configuration.encrypted,
│   on storage.tf line 28, in resource "aws_s3_bucket_server_side_encryption_configuration" "encrypted":
│   28: resource "aws_s3_bucket_server_side_encryption_configuration" "encrypted" {

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 4: Service-Linked Role Missing
# ============================================================================

Terraform will perform the following actions:

  # aws_elasticsearch_domain.main will be created

Plan: 1 to add, 0 to change, 0 to destroy.

aws_elasticsearch_domain.main: Creating...

│ Error: creating Elasticsearch Domain (search-prod): ValidationException:
│ Before you can proceed, you must enable a service-linked role to give Amazon ES
│ permissions to access your VPC. Choose "Enable access" to create the service-linked role.
│
│   with aws_elasticsearch_domain.main,
│   on elasticsearch.tf line 1, in resource "aws_elasticsearch_domain" "main":
│    1: resource "aws_elasticsearch_domain" "main" {

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 5: IAM Policy Limit Exceeded
# ============================================================================

Terraform will perform the following actions:

  # aws_iam_role_policy_attachment.additional will be created

Plan: 1 to add, 0 to change, 0 to destroy.

aws_iam_role_policy_attachment.additional: Creating...

│ Error: attaching IAM Policy (arn:aws:iam::123456789012:policy/custom-policy-11)
│ to IAM Role (application-role): LimitExceeded: Cannot exceed quota for
│ PoliciesPerRole: 10
│
│   with aws_iam_role_policy_attachment.additional,
│   on iam.tf line 156, in resource "aws_iam_role_policy_attachment" "additional":
│  156: resource "aws_iam_role_policy_attachment" "additional" {
