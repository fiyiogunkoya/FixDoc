# Helm Errors - Comprehensive Test Fixtures
# Real-world Helm install, upgrade, and template errors

# ============================================================================
# Test Case 1: Release Already Exists
# ============================================================================

$ helm install myapp ./charts/myapp -n production

Error: INSTALLATION FAILED: cannot re-use a name that is still in use

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 2: Chart Not Found
# ============================================================================

$ helm install myapp bitnami/nonexistent-chart

Error: INSTALLATION FAILED: chart "nonexistent-chart" not found in https://charts.bitnami.com/bitnami repository

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 3: Values File Not Found
# ============================================================================

$ helm install myapp ./charts/myapp -f values-production.yaml

Error: INSTALLATION FAILED: open values-production.yaml: no such file or directory

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 4: Template Rendering Error
# ============================================================================

$ helm install myapp ./charts/myapp --set replicas=abc

Error: INSTALLATION FAILED: template: myapp/templates/deployment.yaml:12:20: executing "myapp/templates/deployment.yaml" at <.Values.replicas>: invalid value; expected int

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 5: Invalid YAML in Values
# ============================================================================

$ helm install myapp ./charts/myapp -f values.yaml

Error: INSTALLATION FAILED: error unmarshaling JSON: while decoding JSON: json: cannot unmarshal string into Go struct field .resources.limits.memory of type resource.Quantity

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 6: Helm Upgrade - Release Not Found
# ============================================================================

$ helm upgrade myapp ./charts/myapp -n production

Error: UPGRADE FAILED: "myapp" has no deployed releases

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 7: Kubernetes API Server Unavailable
# ============================================================================

$ helm install myapp ./charts/myapp

Error: INSTALLATION FAILED: Kubernetes cluster unreachable: Get "https://kubernetes.docker.internal:6443/version": dial tcp 192.168.65.4:6443: connect: connection refused

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 8: RBAC Permission Denied
# ============================================================================

$ helm install prometheus prometheus-community/kube-prometheus-stack -n monitoring

Error: INSTALLATION FAILED: failed to create resource: clusterroles.rbac.authorization.k8s.io is forbidden: User "system:serviceaccount:default:helm" cannot create resource "clusterroles" in API group "rbac.authorization.k8s.io" at the cluster scope

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 9: Dependency Update Required
# ============================================================================

$ helm install myapp ./charts/myapp

Error: INSTALLATION FAILED: An error occurred while checking for chart dependencies. You may need to run `helm dependency build` to fetch missing dependencies: found in Chart.yaml, but missing in charts/ directory: postgresql, redis

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 10: Hook Execution Failed
# ============================================================================

$ helm install myapp ./charts/myapp

Error: INSTALLATION FAILED: failed pre-install: job failed: BackoffLimitExceeded

$ kubectl logs job/myapp-pre-install-hook -n default

Error: Database migration failed
  Cause: FATAL: password authentication failed for user "postgres"
  Connection refused to host: postgres-postgresql.database.svc.cluster.local

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 11: Resource Quota Exceeded During Install
# ============================================================================

$ helm install myapp ./charts/myapp -n production

Error: INSTALLATION FAILED: 1 error occurred:
	* Deployment.apps "myapp-api" is forbidden: exceeded quota: compute-resources, requested: limits.cpu=4, used: limits.cpu=7, limited: limits.cpu=8

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 12: Timeout Waiting for Resources
# ============================================================================

$ helm install myapp ./charts/myapp --wait --timeout 5m

Error: INSTALLATION FAILED: timed out waiting for the condition

RESOURCES:
==> v1/Deployment
NAME        READY   UP-TO-DATE   AVAILABLE   AGE
myapp-api   0/3     3            0           5m2s

NOTES:
1. Get the application URL by running these commands:
  kubectl get pods -l "app=myapp" -n default

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 13: Helm Rollback Failed
# ============================================================================

$ helm rollback myapp 5 -n production

Error: ROLLBACK FAILED: cannot rollback to revision 5: release "myapp" has been uninstalled

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 14: Invalid Chart Version
# ============================================================================

$ helm install myapp bitnami/postgresql --version 99.99.99

Error: INSTALLATION FAILED: chart "postgresql" matching version "99.99.99" not found in bitnami index. (try 'helm repo update'): no chart version found for postgresql-99.99.99

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 15: CRD Already Exists
# ============================================================================

$ helm install cert-manager jetstack/cert-manager --set installCRDs=true

Error: INSTALLATION FAILED: rendered manifests contain a resource that already exists. Unable to continue with install: CustomResourceDefinition "certificates.cert-manager.io" in namespace "" exists and cannot be imported into the current release: invalid ownership metadata; annotation validation error: key "meta.helm.sh/release-name" must equal "cert-manager": current value is "cert-manager-old"

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 16: Secret Not Found for Image Pull
# ============================================================================

$ helm install myapp ./charts/myapp

Warning: Kubernetes reported a warning: imagepullsecrets.v1 "regcred" not found

Error: INSTALLATION FAILED: timed out waiting for the condition

$ kubectl describe pod myapp-api-5d8f9c7b6-abc12

Events:
  Type     Reason     Age   From               Message
  ----     ------     ----  ----               -------
  Warning  Failed     30s   kubelet            Failed to pull image "private.registry.io/myapp:v1.0.0": rpc error: code = Unknown desc = failed to pull and unpack image "private.registry.io/myapp:v1.0.0": failed to resolve reference "private.registry.io/myapp:v1.0.0": pulling from host private.registry.io failed with status code: 401 Unauthorized

---FIXTURE_SEPARATOR---

# ============================================================================
# Test Case 17: PVC Storage Class Not Found (Helm)
# ============================================================================

$ helm install mydb bitnami/postgresql -n database

Error: INSTALLATION FAILED: failed to create resource: PersistentVolumeClaim "data-mydb-postgresql-0" is invalid: spec.storageClassName: Invalid value: "gp3": storageclass.storage.k8s.io "gp3" not found
